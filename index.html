<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <title>Kartu Pengawasan Angsuran</title>

    <style>
        @page {
            margin: 0.5cm;
        }

        body {
            font-family: "Times New Roman", Times, serif;
            font-size: 10pt;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #000;
            padding: 2px 4px;
            vertical-align: middle;
        }

        /* Utility Classes */
        .no-border td {
            border: none;
        }

        .center {
            text-align: center;
        }

        .right {
            text-align: right;
        }

        .left {
            text-align: left;
        }

        .bold {
            font-weight: bold;
        }

        .valign-top {
            vertical-align: top;
        }

        /* Footer Style */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            font-size: 10pt;
            background-color: white;
            /* Opsional: agar tulisan jelas jika menumpuk */
            padding-top: 5px;
        }

        /* ================= KUNCI PENJAJARAN (ALIGNMENT KEY) ================= */
        /* Total Anchor point target kita adalah 22% (5% + 17%) */

        /* 1. Untuk Tabel Utama (Bawah) */
        .w-no {
            width: 5%;
        }

        /* Kolom (1) Ang ke */
        .w-date {
            width: 17%;
        }

        /* Kolom (2) Tanggal Setor */

        /* 2. Untuk Tabel Atas (Agar sejajar dengan 22%) */
        .w-label {
            width: 20%;
        }

        /* Label (Nama, Alamat, dll) */
        .w-sep {
            width: 2%;
            text-align: center;
        }

        /* Kolom Titik Dua (:) */

        /* Sisa lebar untuk isi data */
        .w-val {
            width: 48%;
        }

        /* Isi Data Tengah */
        .w-val-right {
            width: 30%;
        }

        /* Isi Data Kanan (ID Mitra) */
        .ttd-kanan {
    position: absolute;
    right: 0;
    top: 63%;
    width: 28%;
    text-align: center;
    font-size: 10pt;
}

    </style>
</head>

<body>
    <div class="container">
        <table class="no-border">
            <tr>
                <td width="25%">
                    <img src="{{ public_path('images/posind.png') }}" alt="Logo" width="40%" />
                </td>
                <td width="50%" class="center bold">
                    KARTU PENGAWASAN<br />PEMBAYARAN ANGSURAN PINJAMAN<br />{{ strtoupper($h->tjsld) }}
                </td>
                <td width="25%" class="right bold">Kug-3</td>
            </tr>
        </table>
        <br />

        <table class="no-border">
            <tr>
                <td class="w-label">Nama Mitra Binaan</td>
                <td class="w-sep">:</td>
                <td class="w-val">{{ $h->nama }}</td>
                <td class="w-val-right">ID Mitra Binaan : {{ $h->id_mb }}</td>
            </tr>
            <tr>
                <td class="w-label">Nomor Register</td>
                <td class="w-sep">:</td>
                <td class="w-val">{{ $h->noregistrasi }}</td>
                <td class="w-val-right"></td>
            </tr>
            <tr>
                <td class="w-label valign-top">Alamat Usaha</td>
                <td class="w-sep valign-top">:</td>
                <td class="w-val valign-top" colspan="2">
                    {{ $h->alamat }}
                </td>
            </tr>
            <tr>
                <td class="w-label valign-top">Alamat Rumah</td>
                <td class="w-sep valign-top">:</td>
                <td class="w-val valign-top" colspan="2">
                    -
                </td>
            </tr>

            <tr>
                <td class="w-label">Jenis Usaha</td>
                <td class="w-sep">:</td>
                <td class="w-val" colspan="2">{{ $h->jenis_usaha }}</td>
            </tr>

            <tr>
                <td class="w-label">Nomor Telepon</td>
                <td class="w-sep">:</td>
                <td class="w-val" colspan="2">-</td>
            </tr>
        </table>

        <table class="no-border" style="margin-top: 5px">
            <tr class="center bold">
                <td colspan="2" style="width: 22%"></td>

                <td width="26%">Pokok</td>
                <td width="26%">Jasa</td>
                <td width="26%">Jumlah</td>
            </tr>
            <tr>
                <td class="w-label">Jumlah Pinjaman</td>
                <td class="w-sep">:</td>
                <td class="center">Rp. {{ number_format($h->jumlah_realisasi, 0, ',', '.') }}</td>
                <td class="center">Rp. 0</td>
                <td class="center">Rp. {{ number_format($h->jumlah_realisasi, 0, ',', '.') }}</td>
            </tr>
        </table>

        <table class="no-border" style="margin-top: 5px">
            <tr>
                <td colspan="3" style="width: 22%"></td>
                <td class="bold">Rata-rata Angsuran</td>
            </tr>

            <tr>
                <td style="width: 5%"></td>
                <td style="width: 15%">Tahun ke-1</td>
                <td class="w-sep">:</td>
                <td>Rp. 290.000</td>
            </tr>
            <tr>
                <td style="width: 5%"></td>
                <td style="width: 15%">Tahun ke-2</td>
                <td class="w-sep">:</td>
                <td>Rp. 290.000</td>
            </tr>
            <tr>
                <td style="width: 5%"></td>
                <td style="width: 15%">Tahun ke-3</td>
                <td class="w-sep">:</td>
                <td>Rp. 290.000</td>
            </tr>
        </table>

        <table class="no-border">
            <tr>
                <td class="w-label">Periode Angsuran</td>
                <td class="w-sep">:</td>
                <td>Januari 2023 s/d Desember 2025</td>
            </tr>
            <tr>
                <td class="w-label">Jasa Pinjaman</td>
                <td class="w-sep">:</td>
                <td>Anuitas 3%</td>
            </tr>
            <div class="ttd-kanan">
                Asman/Manajer PKBLD<br />
                Bandung<br /><br /><br /><br />
                <strong><u>Dody Frisenaldy</u></strong><br />
                Nippos 974358368
            </div>

        </table>

        <br />

        <table>
            <thead>
                <tr class="center bold">
                    <th class="w-no" rowspan="2">Ang.<br />ke</th>
                    <th class="w-date" rowspan="2">Angsuran<br />Bulan</th>
                    <th colspan="3">Penerimaan Angsuran</th>
                    <th colspan="3">Sisa Pinjaman</th>
                    <th rowspan="2">Keterangan</th>
                </tr>
                <tr class="center bold">
                    <th>Pokok</th>
                    <th>Jasa</th>
                    <th>Jumlah</th>
                    <th>Pokok</th>
                    <th>Jasa</th>
                    <th>Jumlah</th>
                </tr>
                <tr class="center small" style="font-size: 8pt">
                    <td>(1)</td>
                    <td>(2)</td>
                    <td>(3)</td>
                    <td>(4)</td>
                    <td>(5)</td>
                    <td>(6)</td>
                    <td>(7)</td>
                    <td>(8)</td>
                    <td>(9)</td>
                </tr>
            </thead>

            <tbody>
                @php
                    $total_pokok = 0;
                    $total_jasa = 0;
                    $total_jumlah = 0;

                    // Inisialisasi Sisa Pinjaman Awal (Estimasi)
                    $sisa_pokok = $h->jumlah_realisasi;
                    // Sisa jasa sebaiknya diambil dari logic database yang benar,
                    // disini estimasi pengurangan manual untuk display loop
                    $sisa_jasa = $jasa_pinjaman ?? 0;
                @endphp

                @foreach ($riwayat as $row)
                    @php
                        // Akumulasi Total
                        // Note: Asumsi kolom angsuran_pokok & angsuran_jasa ada di DB,
                        // Jika di DB hanya ada 'angsuran_bulan' (total), perlu dipecah logicnya.
                        // Di sini saya pakai angsuran_pokok/jasa sesuai asumsi kolom umum.
                        $bayar_pokok = $row->angsuran_bsu;
                        $bayar_jasa = $row->angsuran_jasa;
                        $bayar_total = $bayar_pokok + $bayar_jasa;

                        $total_pokok += $bayar_pokok;
                        $total_jasa += $bayar_jasa;
                        $total_jumlah += $bayar_total;

                        // Hitung Sisa (Untuk Display Saja, idealnya ambil dari kolom 'outstanding' di DB)
                        // Namun 'outstanding' di DB biasanya hanya sisa pokok.
                        $sisa_pokok_display = $row->outstanding;
                        // Sisa jasa dan total sisa pinjaman butuh data lebih detail di DB
                        $sisa_jasa_display = 0; // Placeholder
                        $sisa_total_display = $sisa_pokok_display + $sisa_jasa_display;
                    @endphp
                    <tr>
                        <td class="center">{{ $row->angsuran_ke }}</td>
                        <td class="center">{{ $row->angsuran_bulan }}</td>
                        {{-- Penerimaan Angsuran --}}
                        <td class="right">{{ number_format($bayar_pokok, 0, ',', '.') }}</td>
                        <td class="right">{{ number_format($bayar_jasa, 0, ',', '.') }}</td>
                        <td class="right">{{ number_format($bayar_total, 0, ',', '.') }}</td>
                        <td class="right">{{ number_format($sisa_pokok_display, 0, ',', '.') }}</td>
                        <td class="right">{{ number_format($sisa_jasa_display, 0, ',', '.') }}</td>
                        <td class="right">{{ number_format($sisa_total_display, 0, ',', '.') }}</td>
                        <td class="center">POSPAY</td>
                    </tr>
                @endforeach

                <tr style="font-weight: bold; background-color: #f9f9f9">
                    <td colspan="2" class="center">Jumlah</td>
                    <td class="right">{{ number_format($total_pokok, 0, ',', '.') }}</td>
                    <td class="right">{{ number_format($total_jasa, 0, ',', '.') }}</td>
                    <td class="right">{{ number_format($total_jumlah, 0, ',', '.') }}</td>
                    <td class="right"></td>
                    <td class="right"></td>
                    <td class="right"></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <div class="footer">Dicetak pada: {{ $cetak_date }}</div>
    </div>
</body>

</html>



